--- !<experiment>
name: "demo/ADM/ADM-18"
version: "0"
type: "experiment"
description: "When a single container from steadybit-demo/hot-deals fails then within\
  \ 2m all pods are ready."
inputs:
- name: "environmentName"
  type: "string"
  required: true
- name: "teamKey"
  type: "string"
  required: true
experiment:
  name: "steadybit-demo/hot-deals single container failure"
  team: "{{teamKey}}"
  hypothesis: "When a single container from steadybit-demo/hot-deals fails then within\
    \ 2m all pods are ready."
  environment: "{{environmentName}}"
  lanes:
  - steps:
    - !<action>
      ignoreFailure: false
      parameters:
        duration: "10s"
        namespace: "steadybit-demo"
        cluster: "demo-dev"
        podcount: "podCountEqualsDesiredCount"
        deployment: "hot-deals"
      customLabel: "GIVEN: All pods are ready"
      actionType: "check:kubernetes-pod-count"
    - !<attack>
      ignoreFailure: false
      parameters:
        graceful: "true"
      attackType: "container-stop-attack"
      radius:
        targetType: "container"
        query:
          operator: "AND"
          predicates:
          - key: "k8s.cluster-name"
            operator: "EQUALS"
            values:
            - "demo-dev"
          - key: "k8s.namespace"
            operator: "EQUALS"
            values:
            - "steadybit-demo"
          - key: "k8s.deployment"
            operator: "EQUALS"
            values:
            - "hot-deals"
          - key: "k8s.container.name"
            operator: "EQUALS"
            values:
            - "hot-deals"
        maximum: 1
  - steps:
    - !<wait>
      ignoreFailure: false
      parameters:
        duration: "10s"
    - !<action>
      ignoreFailure: false
      parameters:
        duration: "10s"
        namespace: "steadybit-demo"
        cluster: "demo-dev"
        podcount: "podCountLessThanDesiredCount"
        deployment: "hot-deals"
      customLabel: "THEN: Ready Pod Count decreases"
      actionType: "check:kubernetes-pod-count"
    - !<action>
      ignoreFailure: false
      parameters:
        duration: "2m"
        namespace: "steadybit-demo"
        cluster: "demo-dev"
        podcount: "podCountEqualsDesiredCount"
        deployment: "hot-deals"
      customLabel: "THEN: All pods are ready again within 2m"
      actionType: "check:kubernetes-pod-count"
